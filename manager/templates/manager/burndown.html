{% extends "base.html" %}
{% block headcontent %}
<title>Taskboard {{taskboard_id}} Burndown Chart</title>
{% endblock %}
{% block content %}

<div class="col-8 offset-2 my-5">
  <div class="card">
    <div class="card-body">

      <h5>Burndown Chart</h5>
      <hr>
      <canvas id="myChart"></canvas>

    </div>
  </div>
</div>


<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<script>
  const taskboardId = 1; // Replace with the actual taskboard_id
  const url = `/manager/taskboard/${taskboardId}/burndown/data/`;

  fetch(url)
      .then(response => {
          if (!response.ok) {
              throw new Error('Network response was not ok');
          }
          return response.json();
      })
      .then(data => {

        const date = data.map(item => item.date);
        const time_remaining = data.map(item => item.time_remaining);

        const firstTR = time_remaining[0];
        const lastTR = time_remaining[time_remaining.length - 1];
        const velocity_trend = time_remaining.map((_, index, array) => {
          return firstTR + ((lastTR - firstTR) / (array.length - 1)) * index;
        });

        const ctx = document.getElementById('myChart');

        new Chart(ctx, {
          type: 'bar',
          data: {
            labels: date,
            datasets: [
              {
                label: 'Time Remaining',
                data: time_remaining,
                borderWidth: 1,
              },
              {
                label: 'Velocity Trend',
                data: velocity_trend,
                borderWidth: 1,
                type: 'line'
              }
              ]
          },
          options: {
            scales: {
              y: {
                beginAtZero: true
              }
            }
          }
        });

      })
      .catch(error => {
          console.error('Error fetching burndown data:', error);
      });
</script>

<!-- <div class="container-fluid">
  <a href="#" class="btn btn-secondary my-3">
    Back to Taskboard
  </a>
  <div class="row align-items-start">
    <div class="col">
      Graph {{taskboard_id}}

      {% for event in events %}
      {{event}}
      {% endfor %}
    </div>

    <div class="col">
      <h2>Select Event</h2>
      <form method="post">
        {% csrf_token %}

        <div class="form-check">
          <input class="form-check-input" name="events" type="checkbox" value="a" id="flexCheckDefault">
          <label class="form-check-label" for="flexCheckDefault">
            Default checkbox
          </label>
        </div>

        <div class="form-check">
          <input class="form-check-input" name="events" type="checkbox" value="c" id="flexCheckChecked">
          <label class="form-check-label" for="flexCheckChecked">
            Checked checkbox
          </label>
        </div>

        <input type="submit" value="View event on graph">

      </form>
    
  </div>

</div> -->

{% endblock %}